{"ast":null,"code":"var _jsxFileName = \"/Users/tungngo/Dropbox/Personal/Learning/React/webapp/petbook/web/src/login/Login.js\",\n  _s = $RefreshSig$();\nimport { useRef, useState, useEffect, useContext } from 'react';\nimport DataContext from '../context/DataContext';\nimport { useNavigate, useLocation } from 'react-router-dom';\nimport axios from '../api/axios';\nimport React from 'react';\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nconst LOGIN_URL = '/login';\nconst Login = () => {\n  _s();\n  var _location$state;\n  const userRef = useRef();\n  const errRef = useRef();\n  const {\n    user,\n    setUser,\n    pwd,\n    setPwd,\n    setUserID,\n    setAuth\n  } = useContext(DataContext);\n  const [errMsg, setErrMsg] = useState('');\n  const navigate = useNavigate();\n  const location = useLocation();\n  // const from = location.state?.from.pathname || \"/\";\n  const from = ((_location$state = location.state) === null || _location$state === void 0 ? void 0 : _location$state.from.pathname) || \"/\";\n  useEffect(() => {\n    userRef.current.focus();\n  }, []);\n  useEffect(() => {\n    setErrMsg('');\n  }, [user, pwd]);\n  const handleSubmit = async e => {\n    e.preventDefault();\n    try {\n      var _response$data, _response$data2;\n      const response = await axios.post(LOGIN_URL, JSON.stringify({\n        username: user,\n        password: pwd\n      }), {\n        headers: {\n          'Content-Type': 'application/json'\n        }\n      });\n      console.log(JSON.stringify(response === null || response === void 0 ? void 0 : response.data));\n      const id = response === null || response === void 0 ? void 0 : (_response$data = response.data) === null || _response$data === void 0 ? void 0 : _response$data.id;\n      const accessToken = response === null || response === void 0 ? void 0 : (_response$data2 = response.data) === null || _response$data2 === void 0 ? void 0 : _response$data2.token;\n      setUserID(id);\n      setAuth({\n        user,\n        pwd,\n        accessToken\n      });\n      // const roles = response?.data?.roles;\n      // setUser('');\n      // setPwd('');\n      console.log(from);\n      navigate(from, {\n        replace: true\n      });\n    } catch (err) {\n      var _err$response, _err$response2;\n      if (!(err !== null && err !== void 0 && err.response)) {\n        setErrMsg('No Server Response');\n      } else if (((_err$response = err.response) === null || _err$response === void 0 ? void 0 : _err$response.status) === 400) {\n        setErrMsg('Missing Username or Password');\n      } else if (((_err$response2 = err.response) === null || _err$response2 === void 0 ? void 0 : _err$response2.status) === 401) {\n        setErrMsg('Wrong Username or Password');\n      } else {\n        setErrMsg('Login Failed');\n      }\n      errRef.current.focus();\n    }\n  };\n  return /*#__PURE__*/_jsxDEV(\"section\", {\n    children: [/*#__PURE__*/_jsxDEV(\"p\", {\n      ref: errRef,\n      className: errMsg ? \"errmsg\" : \"offscreen\",\n      \"aria-live\": \"assertive\",\n      children: errMsg\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 66,\n      columnNumber: 17\n    }, this), /*#__PURE__*/_jsxDEV(\"h1\", {\n      children: \"Sign In\"\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 67,\n      columnNumber: 17\n    }, this), /*#__PURE__*/_jsxDEV(\"form\", {\n      onSubmit: handleSubmit,\n      children: [/*#__PURE__*/_jsxDEV(\"label\", {\n        htmlFor: \"username\",\n        children: \"Username:\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 69,\n        columnNumber: 21\n      }, this), /*#__PURE__*/_jsxDEV(\"input\", {\n        type: \"text\",\n        id: \"username\",\n        ref: userRef,\n        autoComplete: \"off\",\n        onChange: e => setUser(e.target.value),\n        value: user,\n        required: true\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 70,\n        columnNumber: 21\n      }, this), /*#__PURE__*/_jsxDEV(\"label\", {\n        htmlFor: \"password\",\n        children: \"Password:\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 80,\n        columnNumber: 21\n      }, this), /*#__PURE__*/_jsxDEV(\"input\", {\n        type: \"password\",\n        id: \"password\",\n        onChange: e => setPwd(e.target.value),\n        value: pwd,\n        required: true\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 81,\n        columnNumber: 21\n      }, this), /*#__PURE__*/_jsxDEV(\"button\", {\n        children: \"Sign In\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 88,\n        columnNumber: 21\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 68,\n      columnNumber: 17\n    }, this), /*#__PURE__*/_jsxDEV(\"p\", {\n      children: [\"Need an Account?\", /*#__PURE__*/_jsxDEV(\"br\", {}, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 91,\n        columnNumber: 37\n      }, this), /*#__PURE__*/_jsxDEV(\"span\", {\n        className: \"line\",\n        children: /*#__PURE__*/_jsxDEV(\"a\", {\n          href: \"register\",\n          children: \"Sign Up\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 93,\n          columnNumber: 25\n        }, this)\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 92,\n        columnNumber: 21\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 90,\n      columnNumber: 17\n    }, this)]\n  }, void 0, true, {\n    fileName: _jsxFileName,\n    lineNumber: 65,\n    columnNumber: 13\n  }, this);\n};\n_s(Login, \"H8bJUNfOtn8zgSZjL9YzOMnAfb4=\", false, function () {\n  return [useNavigate, useLocation];\n});\n_c = Login;\nexport default Login;\nvar _c;\n$RefreshReg$(_c, \"Login\");","map":{"version":3,"names":["useRef","useState","useEffect","useContext","DataContext","useNavigate","useLocation","axios","React","jsxDEV","_jsxDEV","LOGIN_URL","Login","_s","_location$state","userRef","errRef","user","setUser","pwd","setPwd","setUserID","setAuth","errMsg","setErrMsg","navigate","location","from","state","pathname","current","focus","handleSubmit","e","preventDefault","_response$data","_response$data2","response","post","JSON","stringify","username","password","headers","console","log","data","id","accessToken","token","replace","err","_err$response","_err$response2","status","children","ref","className","fileName","_jsxFileName","lineNumber","columnNumber","onSubmit","htmlFor","type","autoComplete","onChange","target","value","required","href","_c","$RefreshReg$"],"sources":["/Users/tungngo/Dropbox/Personal/Learning/React/webapp/petbook/web/src/login/Login.js"],"sourcesContent":["import { useRef, useState, useEffect, useContext } from 'react';\nimport DataContext from '../context/DataContext';\nimport { useNavigate, useLocation } from 'react-router-dom';\nimport axios from '../api/axios';\nimport React from 'react';\n\nconst LOGIN_URL = '/login';\n\nconst Login = () => {\n    const userRef = useRef();\n    const errRef = useRef();\n\n    const { user, setUser, pwd, setPwd, setUserID, setAuth } = useContext(DataContext);\n    const [errMsg, setErrMsg] = useState('');\n\n    const navigate = useNavigate();\n    const location = useLocation();\n    // const from = location.state?.from.pathname || \"/\";\n    const from = location.state?.from.pathname || \"/\";\n\n\n    useEffect(() => {\n        userRef.current.focus();\n    }, [])\n\n    useEffect(() => {\n        setErrMsg('');\n    }, [user, pwd])\n\n    const handleSubmit = async (e) => {\n        e.preventDefault();\n        try {\n            const response = await axios.post(LOGIN_URL,\n                JSON.stringify({ username: user, password: pwd }),\n                {\n                    headers: { 'Content-Type': 'application/json' },\n                }\n            );\n            console.log(JSON.stringify(response?.data))\n            const id = response?.data?.id;\n            const accessToken = response?.data?.token;\n            setUserID(id)\n            setAuth({ user, pwd, accessToken })\n            // const roles = response?.data?.roles;\n            // setUser('');\n            // setPwd('');\n            console.log(from)\n            navigate(from, { replace: true });\n\n        } catch (err) {\n            if (!err?.response) {\n                setErrMsg('No Server Response');\n            } else if (err.response?.status === 400) {\n                setErrMsg('Missing Username or Password');\n            } else if (err.response?.status === 401) {\n                setErrMsg('Wrong Username or Password');\n            } else {\n                setErrMsg('Login Failed');\n            }\n            errRef.current.focus();\n        }\n    }\n\n    return (\n            <section>\n                <p ref={errRef} className={errMsg ? \"errmsg\" : \"offscreen\"} aria-live=\"assertive\">{errMsg}</p>\n                <h1>Sign In</h1>\n                <form onSubmit={handleSubmit}>\n                    <label htmlFor=\"username\">Username:</label>\n                    <input\n                        type=\"text\"\n                        id=\"username\"\n                        ref={userRef}\n                        autoComplete=\"off\"\n                        onChange={(e) => setUser(e.target.value)}\n                        value={user}\n                        required\n                    />\n\n                    <label htmlFor=\"password\">Password:</label>\n                    <input\n                        type=\"password\"\n                        id=\"password\"\n                        onChange={(e) => setPwd(e.target.value)}\n                        value={pwd}\n                        required\n                    />\n                    <button>Sign In</button>\n                </form>\n                <p>\n                    Need an Account?<br />\n                    <span className=\"line\">\n                        <a href=\"register\">Sign Up</a>\n                    </span>\n                </p>\n            </section>\n\n    )\n}\n\nexport default Login"],"mappings":"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"},"metadata":{},"sourceType":"module","externalDependencies":[]}