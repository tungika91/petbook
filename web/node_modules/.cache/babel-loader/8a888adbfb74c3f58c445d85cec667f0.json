{"ast":null,"code":"import _regeneratorRuntime from\"/Users/tungngo/Dropbox/Personal/Learning/React/webapp/petbook/web/node_modules/babel-preset-react-app/node_modules/@babel/runtime/regenerator\";import _asyncToGenerator from\"/Users/tungngo/Dropbox/Personal/Learning/React/webapp/petbook/web/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/asyncToGenerator\";import _slicedToArray from\"/Users/tungngo/Dropbox/Personal/Learning/React/webapp/petbook/web/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/slicedToArray\";import{useRef,useState,useEffect,useContext}from'react';import DataContext from'../context/DataContext';import{useNavigate,useLocation}from'react-router-dom';import axios from'../api/axios';import{jsx as _jsx}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";var LOGIN_URL='/login';var Login=function Login(){var _location$state;var userRef=useRef();var errRef=useRef();var _useContext=useContext(DataContext),user=_useContext.user,setUser=_useContext.setUser,pwd=_useContext.pwd,setPwd=_useContext.setPwd,setUserID=_useContext.setUserID,setAuth=_useContext.setAuth;var _useState=useState(''),_useState2=_slicedToArray(_useState,2),errMsg=_useState2[0],setErrMsg=_useState2[1];var navigate=useNavigate();var location=useLocation();var from=((_location$state=location.state)===null||_location$state===void 0?void 0:_location$state.from.pathname)||\"/\";useEffect(function(){userRef.current.focus();},[]);useEffect(function(){setErrMsg('');},[user,pwd]);var handleSubmit=/*#__PURE__*/function(){var _ref=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee(e){var _response$data,_response$data2,response,id,accessToken,_err$response,_err$response2;return _regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:e.preventDefault();_context.prev=1;_context.next=4;return axios.post(LOGIN_URL,JSON.stringify({username:user,password:pwd}),{headers:{'Content-Type':'application/json'}});case 4:response=_context.sent;console.log(JSON.stringify(response===null||response===void 0?void 0:response.data));id=response===null||response===void 0?void 0:(_response$data=response.data)===null||_response$data===void 0?void 0:_response$data.id;accessToken=response===null||response===void 0?void 0:(_response$data2=response.data)===null||_response$data2===void 0?void 0:_response$data2.token;setUserID(id);setAuth({user:user,pwd:pwd,accessToken:accessToken});// const roles = response?.data?.roles;\n// setUser('');\n// setPwd('');\nconsole.log(from);navigate(from,{replace:true});_context.next=18;break;case 14:_context.prev=14;_context.t0=_context[\"catch\"](1);if(!(_context.t0===null||_context.t0===void 0?void 0:_context.t0.response)){setErrMsg('No Server Response');}else if(((_err$response=_context.t0.response)===null||_err$response===void 0?void 0:_err$response.status)===400){setErrMsg('Missing Username or Password');}else if(((_err$response2=_context.t0.response)===null||_err$response2===void 0?void 0:_err$response2.status)===401){setErrMsg('Wrong Username or Password');}else{setErrMsg('Login Failed');}errRef.current.focus();case 18:case\"end\":return _context.stop();}}},_callee,null,[[1,14]]);}));return function handleSubmit(_x){return _ref.apply(this,arguments);};}();return/*#__PURE__*/_jsxs(\"section\",{children:[/*#__PURE__*/_jsx(\"p\",{ref:errRef,className:errMsg?\"errmsg\":\"offscreen\",\"aria-live\":\"assertive\",children:errMsg}),/*#__PURE__*/_jsx(\"h1\",{children:\"Sign In\"}),/*#__PURE__*/_jsxs(\"form\",{onSubmit:handleSubmit,children:[/*#__PURE__*/_jsx(\"label\",{htmlFor:\"username\",children:\"Username:\"}),/*#__PURE__*/_jsx(\"input\",{type:\"text\",id:\"username\",ref:userRef,autoComplete:\"off\",onChange:function onChange(e){return setUser(e.target.value);},value:user,required:true}),/*#__PURE__*/_jsx(\"label\",{htmlFor:\"password\",children:\"Password:\"}),/*#__PURE__*/_jsx(\"input\",{type:\"password\",id:\"password\",onChange:function onChange(e){return setPwd(e.target.value);},value:pwd,required:true}),/*#__PURE__*/_jsx(\"button\",{children:\"Sign In\"})]}),/*#__PURE__*/_jsxs(\"p\",{children:[\"Need an Account?\",/*#__PURE__*/_jsx(\"br\",{}),/*#__PURE__*/_jsx(\"span\",{className:\"line\",children:/*#__PURE__*/_jsx(\"a\",{href:\"register\",children:\"Sign Up\"})})]})]});};export default Login;","map":{"version":3,"sources":["/Users/tungngo/Dropbox/Personal/Learning/React/webapp/petbook/web/src/login/Login.js"],"names":["useRef","useState","useEffect","useContext","DataContext","useNavigate","useLocation","axios","LOGIN_URL","Login","userRef","errRef","user","setUser","pwd","setPwd","setUserID","setAuth","errMsg","setErrMsg","navigate","location","from","state","pathname","current","focus","handleSubmit","e","preventDefault","post","JSON","stringify","username","password","headers","response","console","log","data","id","accessToken","token","replace","status","target","value"],"mappings":"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","sourcesContent":["import { useRef, useState, useEffect, useContext } from 'react';\nimport DataContext from '../context/DataContext';\nimport { useNavigate, useLocation } from 'react-router-dom';\nimport axios from '../api/axios';\n\nconst LOGIN_URL = '/login';\n\nconst Login = () => {\n    const userRef = useRef();\n    const errRef = useRef();\n\n    const { user, setUser, pwd, setPwd, setUserID, setAuth } = useContext(DataContext);\n    const [errMsg, setErrMsg] = useState('');\n\n    const navigate = useNavigate();\n    const location = useLocation();\n    const from = location.state?.from.pathname || \"/\";\n\n    useEffect(() => {\n        userRef.current.focus();\n    }, [])\n\n    useEffect(() => {\n        setErrMsg('');\n    }, [user, pwd])\n\n    const handleSubmit = async (e) => {\n        e.preventDefault();\n        try {\n            const response = await axios.post(LOGIN_URL,\n                JSON.stringify({ username: user, password: pwd }),\n                {\n                    headers: { 'Content-Type': 'application/json' },\n                }\n            );\n            console.log(JSON.stringify(response?.data))\n            const id = response?.data?.id;\n            const accessToken = response?.data?.token;\n            setUserID(id)\n            setAuth({ user, pwd, accessToken })\n            // const roles = response?.data?.roles;\n            // setUser('');\n            // setPwd('');\n            console.log(from)\n            navigate(from, { replace: true });\n\n        } catch (err) {\n            if (!err?.response) {\n                setErrMsg('No Server Response');\n            } else if (err.response?.status === 400) {\n                setErrMsg('Missing Username or Password');\n            } else if (err.response?.status === 401) {\n                setErrMsg('Wrong Username or Password');\n            } else {\n                setErrMsg('Login Failed');\n            }\n            errRef.current.focus();\n        }\n    }\n\n    return (\n            <section>\n                <p ref={errRef} className={errMsg ? \"errmsg\" : \"offscreen\"} aria-live=\"assertive\">{errMsg}</p>\n                <h1>Sign In</h1>\n                <form onSubmit={handleSubmit}>\n                    <label htmlFor=\"username\">Username:</label>\n                    <input\n                        type=\"text\"\n                        id=\"username\"\n                        ref={userRef}\n                        autoComplete=\"off\"\n                        onChange={(e) => setUser(e.target.value)}\n                        value={user}\n                        required\n                    />\n\n                    <label htmlFor=\"password\">Password:</label>\n                    <input\n                        type=\"password\"\n                        id=\"password\"\n                        onChange={(e) => setPwd(e.target.value)}\n                        value={pwd}\n                        required\n                    />\n                    <button>Sign In</button>\n                </form>\n                <p>\n                    Need an Account?<br />\n                    <span className=\"line\">\n                        <a href=\"register\">Sign Up</a>\n                    </span>\n                </p>\n            </section>\n\n    )\n}\n\nexport default Login"]},"metadata":{},"sourceType":"module"}